{% extends "base.html" %}

{% block title %}Restaurant Roulette - Find Your Perfect Dining Experience{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="header">
    <div class="logo">
        <i class="fas fa-utensils"></i>
    </div>
    <h1>Restaurant Roulette</h1>
    <p>Discover amazing restaurants with a fun spin! Let the roulette wheel choose your perfect dining spot based on your mood.</p>
</div>

<!-- Feature Highlights -->
<div class="features">
    <div class="feature-card">
        <div class="feature-icon">
            <i class="fas fa-map-marker-alt"></i>
        </div>
        <h3>Location-Based</h3>
        <p>Search anywhere you want.</p>
    </div>
    <div class="feature-card">
        <div class="feature-icon">
            <i class="fas fa-magic"></i>
        </div>
        <h3>Mood-Based Magic</h3>
        <p>Match your vibe.</p>
    </div>
    <div class="feature-card">
        <div class="feature-icon">
            <i class="fas fa-star"></i>
        </div>
        <h3>Real Reviews</h3>
        <p>Trusted sources.</p>
    </div>
</div>

<!-- Main Search Form -->
<div class="main-content">
    <h2 class="section-title">Find Your Perfect Restaurant</h2>
    <p class="section-subtitle">Enter your location and dining mood!</p>
    
            <form id="searchForm">
        <!-- Location Input -->
        <div class="form-group">
            <label for="location" class="form-label">
                <i class="fas fa-map-marker-alt"></i>
                <i class="fas fa-magic"></i>
                Where's the action?
                        </label>
            <input type="text" class="form-control" id="location" 
                   placeholder="Enter city, area, or address..." required>
            
            <!-- Suggested Locations -->
            <div class="location-buttons">
                <button type="button" class="location-btn" data-location="New York City, NY">New York City, NY</button>
                <button type="button" class="location-btn" data-location="Somerset, NJ">Somerset, NJ</button>
                <button type="button" class="location-btn" data-location="Los Angeles, CA">Los Angeles, CA</button>
                <button type="button" class="location-btn" data-location="Chicago, IL">Chicago, IL</button>
                <button type="button" class="location-btn" data-location="Miami, FL">Miami, FL</button>
                <button type="button" class="location-btn" data-location="San Francisco, CA">San Francisco, CA</button>
                    </div>
                </div>
                
        <!-- Mood Selection -->
        <div class="form-group">
            <label for="mood" class="form-label">
                <i class="fas fa-magic"></i>
                <i class="fas fa-comment"></i>
                What's your vibe?
            </label>
            
            <!-- Predefined Mood Options -->
            <div class="mood-options">
                <button type="button" class="mood-btn" data-mood="spicy and exciting">
                    <div class="mood-title">Spicy & Exciting</div>
                    <div class="mood-description">Hot, bold flavors with energetic atmosphere</div>
                </button>
                <button type="button" class="mood-btn" data-mood="romantic and cozy">
                    <div class="mood-title">Romantic & Cozy</div>
                    <div class="mood-description">Intimate settings perfect for dates</div>
                </button>
                <button type="button" class="mood-btn" data-mood="casual and fun">
                    <div class="mood-title">Casual & Fun</div>
                    <div class="mood-description">Relaxed atmosphere for friends and family</div>
                </button>
                <button type="button" class="mood-btn" data-mood="upscale and elegant">
                    <div class="mood-title">Upscale & Elegant</div>
                    <div class="mood-description">Fine dining with sophisticated ambiance</div>
                    </button>
                </div>
            
            <!-- Custom Mood Input -->
            <input type="text" class="form-control mt-3" id="customMood" 
                   placeholder="Or create your own mood...">
        </div>
        
        <!-- Action Button -->
        <button type="submit" class="action-btn">
            <i class="fas fa-search"></i>
            SPIN ROULETTE!
        </button>
    </form>
    
    <!-- Multiplayer Section -->
    <div class="multiplayer-section">
        <div class="divider">
            <span>OR</span>
        </div>
        <h3 class="multiplayer-title">Play with Friends!</h3>
        <p class="multiplayer-subtitle">Create a multiplayer session and spin together</p>
        <button class="action-btn multiplayer-btn" onclick="goToMultiplayer()">
            <i class="fas fa-users"></i>
            START MULTIPLAYER SESSION
        </button>
    </div>
        
        <!-- Loading indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
        <h4>Finding perfect restaurants for your roulette...</h4>
        <p>This may take a moment as we search for the best matches</p>
        
        <!-- Show a preview roulette wheel while loading -->
        <div class="loading-roulette">
            <div class="roulette-wheel loading-wheel">
                <div class="roulette-center">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="loading-sections">
                    <div class="loading-section">üçΩÔ∏è</div>
                    <div class="loading-section">üçï</div>
                    <div class="loading-section">üçú</div>
                    <div class="loading-section">üçî</div>
                    <div class="loading-section">üç£</div>
                    <div class="loading-section">ü•ò</div>
                    <div class="loading-section">üåÆ</div>
                    <div class="loading-section">ü•ó</div>
                </div>
            </div>
            <p class="loading-text">Preparing your restaurant roulette...</p>
        </div>
        </div>
        
        <!-- Error message -->
    <div class="error-message" id="errorMessage">
        <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText"></span>
    </div>
</div>

<!-- Roulette Ready Section -->
<div id="rouletteReadySection" class="d-none">
    <div class="main-content">
        <div class="roulette-ready-banner">
            <h2>Roulette Ready!</h2>
            <p>Found <span id="restaurantCount">0</span> restaurants in <span id="searchLocation">Location</span> matching '<span id="searchMood">mood</span>' mood</p>
            <p class="instruction">Tap the wheel to spin!</p>
                        </div>
        
        <!-- Roulette Wheel -->
        <div class="roulette-container">
            <div class="roulette-wheel" id="rouletteWheel">
                <div class="roulette-center">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="roulette-sections" id="rouletteSections">
                    <!-- Roulette sections will be generated by JavaScript -->
                </div>
                        </div>
            
            <button class="action-btn" id="spinButton">
                <i class="fas fa-play"></i>
                Spin the Roulette!
            </button>
            <p class="instruction">Click to spin and discover a random restaurant!</p>
                    </div>
        
        <!-- Roulette Table -->
        <div class="roulette-table">
            <h3><i class="fas fa-dice"></i> Roulette Table: <span id="tableCount">0</span> Options</h3>
            <div id="restaurantOptions">
                <!-- Restaurant options will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

<!-- Winner Section -->
<div id="winnerSection" class="d-none">
    <div class="main-content">
        <div class="winner-banner">
            <h2>WINNER!</h2>
            <p>Your roulette selection!</p>
        </div>
        
        <div class="selected-restaurant">
            <h4><i class="fas fa-utensils"></i> SELECTED RESTAURANT</h4>
            <div id="selectedRestaurantContent">
                <!-- Selected restaurant details will be displayed here -->
            </div>
        </div>
        
        <div class="text-center mt-4">
            <button class="btn btn-secondary" onclick="newSearch()">
                <i class="fas fa-search"></i>
                New Search
            </button>
        </div>
    </div>
</div>

<!-- Footer Hint -->
<div class="text-center mt-4">
    <p style="color: #B0B0B0; font-size: 0.9rem;">
        Try: "Somerset, NJ" + "romantic and cozy" Let luck decide where you dine tonight! 
        <i class="fas fa-clover" style="color: #4CAF50;"></i>
    </p>
</div>
{% endblock %}

{% block scripts %}
<style>
/* Roulette Ready Banner */
.roulette-ready-banner {
    background: #2D2D2D;
    border: 2px solid #4CAF50;
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    margin-bottom: 30px;
}

.roulette-ready-banner h2 {
    color: white;
    font-size: 2rem;
    margin-bottom: 10px;
}

.roulette-ready-banner p {
    color: #B0B0B0;
    margin-bottom: 5px;
}

.roulette-ready-banner .instruction {
    color: #4CAF50;
    font-weight: 600;
}

/* Roulette Table */
.roulette-table {
    background: #2D2D2D;
    border: 2px solid #4CAF50;
    border-radius: 15px;
    padding: 30px;
    margin-top: 30px;
}

.roulette-table h3 {
    color: white;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.roulette-table h3 i {
    color: #E91E63;
    margin-right: 10px;
}

.restaurant-option {
    background: #1A1A1A;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
}

.restaurant-option.winner {
    background: #FFD700;
    color: #1A1A1A;
    font-weight: 600;
}

.option-number {
    background: #4CAF50;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 15px;
}

.restaurant-option.winner .option-number {
    background: #E91E63;
}

.option-details {
    flex: 1;
}

.option-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.option-cuisine {
    color: #B0B0B0;
    font-size: 0.9rem;
}

/* Winner Section */
.winner-banner {
    background: linear-gradient(135deg, #FFD700, #FFA000);
    color: #1A1A1A;
    text-align: center;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
}

.winner-banner h2 {
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 10px;
}

.winner-banner p {
    font-size: 1.2rem;
    font-weight: 600;
}

.selected-restaurant {
    background: #2D2D2D;
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
}

.selected-restaurant h4 {
    color: #B0B0B0;
    font-size: 0.9rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.selected-restaurant h4 i {
    color: #E91E63;
    margin-right: 10px;
}

.restaurant-description {
    background: #1A1A1A;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    font-style: italic;
    color: #B0B0B0;
}

.reviews-section h5 {
    color: #FFD700;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
}

.reviews-section h5 i {
    margin-right: 10px;
}

.review-date {
    color: #B0B0B0;
    font-size: 0.9rem;
}

/* Casino-style Roulette */
.roulette-container {
    text-align: center;
    padding: 40px 20px;
}

.roulette-wheel {
    position: relative;
    width: 400px;
    height: 400px;
    margin: 0 auto 30px;
    border-radius: 50%;
    border: 8px solid #FFD700;
    box-shadow: 
        0 0 30px rgba(255, 215, 0, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
    background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
}

.roulette-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #4CAF50, #45A049);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    z-index: 10;
    box-shadow: 
        0 0 20px rgba(0, 0, 0, 0.3),
        inset 0 0 10px rgba(255, 255, 255, 0.1);
    border: 3px solid #FFD700;
}

.roulette-sections {
    position: relative;
    width: 100%;
    height: 100%;
}

.roulette-section {
    position: absolute;
    width: 50%;
    height: 50%;
    top: 0;
    left: 50%;
    transform-origin: 0 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(0, 0, 0, 0.2);
    z-index: 1;
}

.section-content {
    transform: rotate(45deg);
    text-align: center;
    padding: 10px;
}

.section-text {
    font-size: 0.9em;
    line-height: 1.2;
    margin-bottom: 5px;
    font-weight: 700;
}

.section-rating {
    font-size: 0.8em;
    opacity: 0.9;
    color: #FFD700;
}

/* Casino-style colors for sections */
.roulette-section:nth-child(1) { background: linear-gradient(45deg, #FF0000, #CC0000); }
.roulette-section:nth-child(2) { background: linear-gradient(45deg, #000000, #333333); }
.roulette-section:nth-child(3) { background: linear-gradient(45deg, #FF0000, #CC0000); }
.roulette-section:nth-child(4) { background: linear-gradient(45deg, #000000, #333333); }
.roulette-section:nth-child(5) { background: linear-gradient(45deg, #FF0000, #CC0000); }
.roulette-section:nth-child(6) { background: linear-gradient(45deg, #000000, #333333); }
.roulette-section:nth-child(7) { background: linear-gradient(45deg, #FF0000, #CC0000); }
.roulette-section:nth-child(8) { background: linear-gradient(45deg, #000000, #333333); }
.roulette-section:nth-child(9) { background: linear-gradient(45deg, #FF0000, #CC0000); }
.roulette-section:nth-child(10) { background: linear-gradient(45deg, #000000, #333333); }

/* Spinning Effect */
.roulette-wheel.spinning {
    box-shadow: 
        0 0 30px rgba(255, 215, 0, 0.6),
        0 0 60px rgba(255, 215, 0, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.2);
}

.roulette-wheel.spinning .roulette-center {
    animation: centerPulse 0.5s ease-in-out infinite alternate;
}

@keyframes centerPulse {
    0% { 
        transform: translate(-50%, -50%) scale(1);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }
    100% { 
        transform: translate(-50%, -50%) scale(1.1);
        box-shadow: 0 0 30px rgba(76, 175, 80, 0.5);
    }
}

/* Loading Screen */
.loading {
    display: none;
    text-align: center;
    padding: 60px 20px;
    background: #1A1A1A;
    border-radius: 15px;
    margin: 20px 0;
}

.loading h4 {
    color: #4CAF50;
    margin-bottom: 10px;
    font-size: 1.5rem;
}

.loading p {
    color: #B0B0B0;
    margin-bottom: 30px;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #333;
    border-top: 4px solid #4CAF50;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Loading Roulette */
.loading-roulette {
    margin-top: 30px;
}

.loading-wheel {
    width: 300px;
    height: 300px;
    margin: 0 auto;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

.loading-sections {
    position: relative;
    width: 100%;
    height: 100%;
}

.loading-section {
    position: absolute;
    width: 50%;
    height: 50%;
    top: 0;
    left: 50%;
    transform-origin: 0 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    animation: rotate 4s linear infinite;
}

.loading-section:nth-child(1) { transform: rotate(0deg); }
.loading-section:nth-child(2) { transform: rotate(45deg); }
.loading-section:nth-child(3) { transform: rotate(90deg); }
.loading-section:nth-child(4) { transform: rotate(135deg); }
.loading-section:nth-child(5) { transform: rotate(180deg); }
.loading-section:nth-child(6) { transform: rotate(225deg); }
.loading-section:nth-child(7) { transform: rotate(270deg); }
.loading-section:nth-child(8) { transform: rotate(315deg); }

@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    text-align: center;
    color: #4CAF50;
    font-weight: 600;
    margin-top: 20px;
    animation: pulse 2s ease-in-out infinite;
}

/* Multiplayer Section */
.multiplayer-section {
    text-align: center;
    margin: 40px 0;
    padding: 30px;
    background: linear-gradient(135deg, #1A1A1A, #2A2A2A);
    border-radius: 15px;
    border: 2px solid #4CAF50;
}

.divider {
    position: relative;
    margin: 20px 0 30px;
    text-align: center;
}

.divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, #4CAF50, transparent);
}

.divider span {
    background: #1A1A1A;
    padding: 0 20px;
    color: #4CAF50;
    font-weight: 600;
    font-size: 0.9rem;
    position: relative;
    z-index: 1;
}

.multiplayer-title {
    color: #4CAF50;
    font-size: 1.8rem;
    margin-bottom: 10px;
    font-weight: 700;
}

.multiplayer-subtitle {
    color: #B0B0B0;
    margin-bottom: 25px;
    font-size: 1.1rem;
}

.multiplayer-btn {
    background: linear-gradient(135deg, #4CAF50, #45A049);
    border: none;
    padding: 15px 30px;
    font-size: 1.2rem;
    font-weight: 600;
    border-radius: 25px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.multiplayer-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
    background: linear-gradient(135deg, #45A049, #4CAF50);
}

/* Responsive Design */
@media (max-width: 768px) {
    .roulette-wheel {
        width: 300px;
        height: 300px;
    }
    
    .loading-wheel {
        width: 250px;
        height: 250px;
    }
    
    .section-text {
        font-size: 0.8em;
    }
    
    .section-rating {
        font-size: 0.7em;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .winner-banner h2 {
        font-size: 2rem;
    }
    
    .multiplayer-title {
        font-size: 1.5rem;
    }
    
    .multiplayer-btn {
        font-size: 1rem;
        padding: 12px 24px;
    }
}
</style>

<script>
// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
    // Global variables
    let restaurantData = null;
    let selectedRestaurant = null;
    let isSpinning = false;
    let currentRotation = 0;

    // Location button handlers
    document.querySelectorAll('.location-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.getElementById('location').value = this.dataset.location;
            document.querySelectorAll('.location-btn').forEach(b => b.style.background = '#E91E63');
            this.style.background = '#C2185B';
        });
    });

    // Mood button handlers
    document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
            document.getElementById('customMood').value = '';
        });
    });

    // Custom mood input handler
    document.getElementById('customMood').addEventListener('input', function() {
        if (this.value.trim()) {
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
        }
    });

    // Form submission
document.getElementById('searchForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const location = document.getElementById('location').value.trim();
        const customMood = document.getElementById('customMood').value.trim();
        const selectedMoodBtn = document.querySelector('.mood-btn.selected');
        const mood = customMood || (selectedMoodBtn ? selectedMoodBtn.dataset.mood : '');
    
    if (!location || !mood) {
        showError('Please enter both location and mood');
        return;
    }
    
        searchRestaurants(location, mood);
    });

    async function searchRestaurants(location, mood) {
        console.log('Starting search for:', location, mood);
        
        try {
            // Show loading, hide search form
            console.log('Hiding search form and showing loading...');
            
            const loadingElement = document.getElementById('loading');
            console.log('Loading element found:', loadingElement);
            // Hide the original loading element and create a new one
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            
            // Create a new loading overlay that will definitely be visible
            const newLoadingOverlay = document.createElement('div');
            newLoadingOverlay.id = 'loadingOverlay';
            newLoadingOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: #1A1A1A;
                z-index: 99999;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: white;
                font-family: Arial, sans-serif;
            `;
            
            newLoadingOverlay.innerHTML = `
                <div style="width: 50px; height: 50px; border: 4px solid #333; border-top: 4px solid #4CAF50; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;"></div>
                <h4 style="color: #4CAF50; margin-bottom: 10px; font-size: 1.5rem;">Finding perfect restaurants for your roulette...</h4>
                <p style="color: #B0B0B0; margin-bottom: 30px;">This may take a moment as we search for the best matches</p>
                <div style="width: 300px; height: 300px; border-radius: 50%; border: 8px solid #FFD700; background: radial-gradient(circle, #FFD700 0%, #FFA500 100%); position: relative; margin: 20px 0;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; background: linear-gradient(135deg, #4CAF50, #45A049); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 3px solid #FFD700;">
                        <i class="fas fa-utensils" style="font-size: 24px;"></i>
                    </div>
                    <div style="position: absolute; top: 0; left: 50%; width: 50%; height: 50%; transform-origin: 0 100%; display: flex; align-items: center; justify-content: center; font-size: 2rem;">üçΩÔ∏è</div>
                    <div style="position: absolute; top: 0; left: 50%; width: 50%; height: 50%; transform-origin: 0 100%; transform: rotate(45deg); display: flex; align-items: center; justify-content: center; font-size: 2rem;">üçï</div>
                    <div style="position: absolute; top: 0; left: 50%; width: 50%; height: 50%; transform-origin: 0 100%; transform: rotate(90deg); display: flex; align-items: center; justify-content: center; font-size: 2rem;">üçú</div>
                    <div style="position: absolute; top: 0; left: 50%; width: 50%; height: 50%; transform-origin: 0 100%; transform: rotate(135deg); display: flex; align-items: center; justify-content: center; font-size: 2rem;">üçî</div>
                </div>
                <p style="text-align: center; color: #4CAF50; font-weight: 600; margin-top: 20px;">Preparing your restaurant roulette...</p>
            `;
            
            // Add to body
            document.body.appendChild(newLoadingOverlay);
            
            console.log('Created new loading overlay');
            document.getElementById('errorMessage').style.display = 'none';
            document.querySelector('.main-content').style.display = 'none';
            document.getElementById('rouletteReadySection').classList.add('d-none');
            document.getElementById('winnerSection').classList.add('d-none');
            
            console.log('Loading screen should now be visible');
            
            // Scroll to loading screen
            document.getElementById('loading').scrollIntoView({ behavior: 'smooth' });
            console.log('Scrolled to loading screen');
            
            console.log('Making API call to /search...');
        const response = await fetch('/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ location, mood })
        });
        
            console.log('API response received, parsing JSON...');
        const data = await response.json();
            console.log('Parsed response:', data);
        
        // Hide loading
            console.log('Hiding loading screen...');
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.remove();
                console.log('Removed loading overlay');
            }
        
        if (data.success) {
                console.log('Success! Calling displayRouletteReady...');
                displayRouletteReady(data);
        } else {
                console.log('Search failed:', data.error);
            showError(data.error || 'An error occurred while searching for restaurants');
                document.querySelector('.main-content').style.display = 'block';
        }
    } catch (error) {
            console.error('Error in searchRestaurants:', error);
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.remove();
            }
        showError('Network error. Please try again.');
            document.querySelector('.main-content').style.display = 'block';
        }
    }

function displayRouletteReady(data) {
    console.log('displayRouletteReady called with:', data);
    
    restaurantData = data;
    
    // Update banner text
    console.log('Updating banner text...');
    document.getElementById('restaurantCount').textContent = data.total_restaurants;
    document.getElementById('searchLocation').textContent = data.location;
    document.getElementById('searchMood').textContent = data.mood;
    document.getElementById('tableCount').textContent = data.total_restaurants;
    
    // Create roulette sections
    console.log('Creating roulette sections...');
    createRouletteSections(data.restaurants);
    
    // Create restaurant options
    console.log('Creating restaurant options...');
    createRestaurantOptions(data.restaurants);
    
    // Show roulette ready section
    console.log('Showing roulette ready section...');
    document.getElementById('rouletteReadySection').classList.remove('d-none');
    
    // Scroll to roulette
    console.log('Scrolling to roulette...');
    document.getElementById('rouletteReadySection').scrollIntoView({ behavior: 'smooth' });
    console.log('displayRouletteReady completed');
}

function createRouletteSections(restaurants) {
    const sectionsContainer = document.getElementById('rouletteSections');
    
    sectionsContainer.innerHTML = '';
    
    restaurants.forEach((restaurant, index) => {
        const section = document.createElement('div');
        section.className = 'roulette-section';
        section.style.transform = `rotate(${index * (360 / restaurants.length)}deg)`;
        
        // Use casino-style red/black alternating colors
        const isRed = index % 2 === 0;
        section.style.background = isRed 
            ? 'linear-gradient(45deg, #FF0000, #CC0000)' 
            : 'linear-gradient(45deg, #000000, #333333)';
        
        // Apply inline styles for proper positioning
        section.style.position = 'absolute';
        section.style.width = '50%';
        section.style.height = '50%';
        section.style.top = '0';
        section.style.left = '50%';
        section.style.transformOrigin = '0 100%';
        section.style.display = 'flex';
        section.style.alignItems = 'center';
        section.style.justifyContent = 'center';
        section.style.color = 'white';
        section.style.fontWeight = 'bold';
        section.style.zIndex = '1';
        
        const sectionContent = document.createElement('div');
        sectionContent.className = 'section-content';
        sectionContent.innerHTML = `
            <div class="section-text">${restaurant.name}</div>
            <div class="section-rating">${restaurant.rating}‚òÖ</div>
        `;
        
        section.appendChild(sectionContent);
        sectionsContainer.appendChild(section);
    });
}

function createRestaurantOptions(restaurants) {
    const optionsContainer = document.getElementById('restaurantOptions');
    optionsContainer.innerHTML = '';
    
    restaurants.forEach((restaurant, index) => {
        const option = document.createElement('div');
        option.className = 'restaurant-option';
        option.innerHTML = `
            <div class="option-number">${index}</div>
            <div class="option-details">
                <div class="option-name">${restaurant.name}</div>
                <div class="option-cuisine">${restaurant.cuisine} ‚Ä¢ ${restaurant.price_range}</div>
        </div>
    `;
        optionsContainer.appendChild(option);
    });
}

function getSectionColor(index) {
    const colors = [
        'linear-gradient(45deg, #ff6b6b, #ee5a24)',
        'linear-gradient(45deg, #4ecdc4, #44a08d)',
        'linear-gradient(45deg, #45b7d1, #96c93d)',
        'linear-gradient(45deg, #f093fb, #f5576c)',
        'linear-gradient(45deg, #4facfe, #00f2fe)',
        'linear-gradient(45deg, #43e97b, #38f9d7)',
        'linear-gradient(45deg, #fa709a, #fee140)',
        'linear-gradient(45deg, #a8edea, #fed6e3)',
        'linear-gradient(45deg, #ff9a9e, #fecfef)',
        'linear-gradient(45deg, #ffecd2, #fcb69f)'
    ];
    return colors[index % colors.length];
}

// Spin button - use event delegation since button is added dynamically
document.addEventListener('click', function(e) {
    if (e.target.id === 'spinButton' || e.target.closest('#spinButton')) {
        spinRoulette();
    }
});

function spinRoulette() {
    if (isSpinning || !restaurantData) return;
    
    isSpinning = true;
    const spinButton = document.getElementById('spinButton');
    const wheel = document.getElementById('rouletteWheel');
    
    // Disable button
    spinButton.disabled = true;
    spinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Spinning...';
    
    // Hide winner section
    document.getElementById('winnerSection').classList.add('d-none');
    
    // Random rotation
    const fullRotations = 5 + Math.random() * 5;
    const randomAngle = Math.random() * 360;
    const totalRotation = currentRotation + (fullRotations * 360) + randomAngle;
    currentRotation = totalRotation;
    
    // Add spinning effect to wheel
    wheel.classList.add('spinning');
    
    // Apply rotation
    wheel.style.transform = `rotate(${totalRotation}deg)`;
    wheel.style.transition = 'transform 4s cubic-bezier(0.23, 1, 0.32, 1)';
    
    // Calculate winner
    setTimeout(() => {
        const restaurants = restaurantData.restaurants;
        const anglePerRestaurant = 360 / restaurants.length;
        const finalAngle = totalRotation % 360;
        const selectedIndex = Math.floor((360 - finalAngle) / anglePerRestaurant) % restaurants.length;
        
        selectedRestaurant = restaurants[selectedIndex];
        showWinner();
        
        // Remove spinning effect
        wheel.classList.remove('spinning');
        
        spinButton.disabled = false;
        spinButton.innerHTML = '<i class="fas fa-play"></i> Spin Again!';
        isSpinning = false;
    }, 4000);
}

function showWinner() {
    // Update restaurant options to highlight winner
    const options = document.querySelectorAll('.restaurant-option');
    options.forEach((option) => {
        option.classList.remove('winner');
        const optionName = option.querySelector('.option-name');
        if (optionName && selectedRestaurant.name === optionName.textContent) {
            option.classList.add('winner');
        }
    });
    
    // Display selected restaurant
    displaySelectedRestaurant();
    
    // Show winner section
    document.getElementById('winnerSection').classList.remove('d-none');
    document.getElementById('winnerSection').scrollIntoView({ behavior: 'smooth' });
}

function displaySelectedRestaurant() {
    const content = document.getElementById('selectedRestaurantContent');
    const stars = '‚òÖ'.repeat(Math.floor(selectedRestaurant.rating)) + '‚òÜ'.repeat(5 - Math.floor(selectedRestaurant.rating));
    
    content.innerHTML = `
            <div class="restaurant-card">
                <div class="restaurant-header">
                <div class="restaurant-name">${selectedRestaurant.name}</div>
                <div class="price-badge">${selectedRestaurant.price_range}</div>
                            </div>
            
            <div class="rating">
                <div class="stars">${stars}</div>
                <div class="rating-text">${selectedRestaurant.rating} (${selectedRestaurant.review_count} reviews)</div>
                        </div>
            
            <div class="restaurant-details">
                <div class="detail-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${selectedRestaurant.address}</span>
                        </div>
                <div class="detail-item">
                    <i class="fas fa-phone"></i>
                    <span>${selectedRestaurant.phone}</span>
                    </div>
                <div class="detail-item">
                    <i class="fas fa-utensils"></i>
                    <span>Cuisine: <span style="color: #FF9800;">${selectedRestaurant.cuisine}</span></span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-heart"></i>
                    <span>Mood: <span style="color: #2196F3;">${restaurantData.mood}</span></span>
                                </div>
                            </div>
                            
            <div class="restaurant-description">
                <p>${selectedRestaurant.mood_match}</p>
                    </div>
                    
                    <div class="reviews-section">
                <h5><i class="fas fa-star"></i> Top Review</h5>
                            <div class="review-card">
                    <div class="review-header">
                        <div class="review-source">${selectedRestaurant.reviews[0].source}</div>
                        <div class="stars">${'‚òÖ'.repeat(selectedRestaurant.reviews[0].rating)}${'‚òÜ'.repeat(5 - selectedRestaurant.reviews[0].rating)}</div>
                    </div>
                    <div class="review-text">"${selectedRestaurant.reviews[0].text}"</div>
                    <div class="review-author">‚Äî ${selectedRestaurant.reviews[0].user_name}</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="spinRoulette()">
                    <i class="fas fa-redo"></i>
                    SPIN AGAIN
                </button>
                <button class="btn btn-info">
                    <i class="fas fa-map-marker-alt"></i>
                    DIRECTIONS
                </button>
                <button class="btn btn-info">
                    <i class="fas fa-phone"></i>
                    CALL
                </button>
                </div>
            </div>
        `;
}

function newSearch() {
    // Reset everything
    document.getElementById('rouletteReadySection').classList.add('d-none');
    document.getElementById('winnerSection').classList.add('d-none');
    document.querySelector('.main-content').style.display = 'block';
    
    // Clear form
    document.getElementById('location').value = '';
    document.getElementById('customMood').value = '';
    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
    
    // Reset variables
    restaurantData = null;
    selectedRestaurant = null;
    currentRotation = 0;
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

    function showError(message) {
        document.getElementById('errorText').textContent = message;
        document.getElementById('errorMessage').style.display = 'block';
    }
    
}); // End of DOMContentLoaded

// Multiplayer navigation function
function goToMultiplayer() {
    window.location.href = '/multiplayer';
}
</script>
{% endblock %}
