{% extends "base.html" %}

{% block title %}Multiplayer Restaurant Roulette - Demo{% endblock %}

{% block content %}
<div class="main-content">
    <!-- Demo Header -->
    <div class="demo-header">
        <div class="demo-badge">
            <i class="fas fa-users"></i>
            MULTIPLAYER DEMO
        </div>
        <h1>Restaurant Roulette</h1>
        <p class="demo-subtitle">Live multiplayer session - Watch multiple users spin together!</p>
    </div>

    <!-- Multiplayer Users Panel -->
    <div class="multiplayer-panel">
        <h3><i class="fas fa-users"></i> Active Players (4)</h3>
        <div class="users-grid">
            <div class="user-card current-user">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name">You</div>
                    <div class="user-status online">● Online</div>
                </div>
            </div>
            <div class="user-card">
                <div class="user-avatar" style="background: linear-gradient(135deg, #FF6B6B, #FF8E8E);">
                    <span>AS</span>
                </div>
                <div class="user-info">
                    <div class="user-name">Alex_Smith</div>
                    <div class="user-status online">● Online</div>
                </div>
            </div>
            <div class="user-card">
                <div class="user-avatar" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">
                    <span>MJ</span>
                </div>
                <div class="user-info">
                    <div class="user-name">Maria_Johnson</div>
                    <div class="user-status online">● Online</div>
                </div>
            </div>
            <div class="user-card">
                <div class="user-avatar" style="background: linear-gradient(135deg, #FFE066, #FF6B6B);">
                    <span>DK</span>
                </div>
                <div class="user-info">
                    <div class="user-name">David_Kim</div>
                    <div class="user-status online">● Online</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Roulette Table -->
    <div class="shared-roulette-container">
        <div class="roulette-ready-banner">
            <h2><i class="fas fa-globe"></i> Shared Roulette Table</h2>
            <p>Found <span class="highlight">3</span> restaurants in <span class="highlight">Somerset, NJ</span> matching '<span class="highlight">spicy and exciting</span>' mood</p>
            <div class="session-info">
                <span class="session-id">Session: #RRL-8A9B2F</span>
                <span class="player-count">4 players connected</span>
            </div>
        </div>
        
        <!-- Casino-style Roulette Wheel -->
        <div class="roulette-container">
            <div class="roulette-wheel" id="rouletteWheel">
                <div class="roulette-center">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="roulette-sections" id="rouletteSections">
                    <!-- Roulette sections will be generated by JavaScript -->
                </div>
            </div>
            
            <div class="multiplayer-controls">
                <button class="action-btn primary" id="spinButton">
                    <i class="fas fa-play"></i>
                    Spin Together!
                </button>
                <div class="spin-indicators">
                    <div class="indicator">
                        <div class="user-avatar small" style="background: linear-gradient(135deg, #FF6B6B, #FF8E8E);">
                            <span>AS</span>
                        </div>
                        <span class="indicator-text">Alex is ready</span>
                    </div>
                    <div class="indicator">
                        <div class="user-avatar small" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">
                            <span>MJ</span>
                        </div>
                        <span class="indicator-text">Maria is ready</span>
                    </div>
                    <div class="indicator">
                        <div class="user-avatar small" style="background: linear-gradient(135deg, #FFE066, #FF6B6B);">
                            <span>DK</span>
                        </div>
                        <span class="indicator-text">David is ready</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shared Restaurant Options -->
        <div class="roulette-table">
            <h3><i class="fas fa-dice"></i> Shared Restaurant Options</h3>
            <div id="restaurantOptions">
                <!-- Restaurant options will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Session Info -->
    <div class="session-info-panel">
        <div class="session-details">
            <div class="session-item">
                <i class="fas fa-door-open"></i>
                <div class="session-label">Lobby ID</div>
                <div class="session-value" id="lobbyId">#RRL-8A9B2F</div>
            </div>
            <div class="session-item">
                <i class="fas fa-clock"></i>
                <div class="session-label">Created</div>
                <div class="session-value" id="sessionTime">2 minutes ago</div>
            </div>
            <div class="session-item">
                <i class="fas fa-map-marker-alt"></i>
                <div class="session-label">Location</div>
                <div class="session-value">Somerset, NJ</div>
            </div>
            <div class="session-item">
                <i class="fas fa-heart"></i>
                <div class="session-label">Mood</div>
                <div class="session-value">Spicy & Exciting</div>
            </div>
        </div>
        
        <div class="lobby-actions">
            <button class="action-btn secondary" id="inviteBtn">
                <i class="fas fa-share"></i>
                Invite Friends
            </button>
            <button class="action-btn secondary" id="copyLobbyBtn">
                <i class="fas fa-copy"></i>
                Copy Lobby ID
            </button>
        </div>
    </div>

    <!-- Demo Notice -->
    <div class="demo-notice">
        <i class="fas fa-info-circle"></i>
        <strong>Demo Mode:</strong> This is a simulation showing how multiplayer roulette would work. Final version will look different.
    </div>
</div>

<style>
/* Demo-specific styles */
.demo-header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
}

.demo-badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 15px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.demo-subtitle {
    margin: 10px 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

/* Multiplayer Panel */
.multiplayer-panel {
    background: #1A1A1A;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid #333;
}

.multiplayer-panel h3 {
    color: #4CAF50;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.users-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.user-card {
    background: #2A2A2A;
    border-radius: 10px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
    border: 1px solid #333;
}

.user-card.current-user {
    border-color: #4CAF50;
    background: linear-gradient(135deg, #2A2A2A, #1A3A1A);
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4CAF50, #45A049);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.9rem;
}

.user-avatar.small {
    width: 24px;
    height: 24px;
    font-size: 0.7rem;
}

.user-info {
    flex: 1;
}

.user-name {
    font-weight: 600;
    color: white;
    margin-bottom: 2px;
}

.user-status {
    font-size: 0.8rem;
    color: #B0B0B0;
}

.user-status.online {
    color: #4CAF50;
}

/* Shared Roulette Container */
.shared-roulette-container {
    background: #1A1A1A;
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid #333;
}

.roulette-ready-banner {
    text-align: center;
    margin-bottom: 30px;
}

.roulette-ready-banner h2 {
    color: #4CAF50;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.highlight {
    color: #FFD700;
    font-weight: 600;
}

.session-info {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    font-size: 0.9rem;
    color: #B0B0B0;
}

.session-id, .player-count {
    background: rgba(76, 175, 80, 0.1);
    padding: 5px 12px;
    border-radius: 15px;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

/* Multiplayer Controls */
.multiplayer-controls {
    text-align: center;
    margin-top: 30px;
}

.action-btn.primary {
    background: linear-gradient(135deg, #4CAF50, #45A049);
    border: none;
    padding: 15px 30px;
    font-size: 1.2rem;
    font-weight: 600;
    border-radius: 25px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 20px;
}

.action-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
}

.spin-indicators {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
}

.indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(76, 175, 80, 0.1);
    padding: 8px 12px;
    border-radius: 15px;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.indicator-text {
    font-size: 0.9rem;
    color: #4CAF50;
    font-weight: 500;
}

/* Session Info Panel */
.session-info-panel {
    background: #1A1A1A;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    border: 1px solid #333;
}

.session-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.session-item {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #2A2A2A;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #333;
    transition: all 0.3s ease;
}

.session-item:hover {
    border-color: #4CAF50;
    background: #2A3A2A;
}

.session-item i {
    color: #4CAF50;
    font-size: 1.2rem;
    width: 20px;
    text-align: center;
}

.session-label {
    color: #B0B0B0;
    font-size: 0.9rem;
    margin-bottom: 2px;
}

.session-value {
    color: white;
    font-weight: 600;
    font-size: 1rem;
}

.lobby-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.action-btn.secondary {
    background: transparent;
    border: 2px solid #4CAF50;
    color: #4CAF50;
    padding: 12px 24px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.action-btn.secondary:hover {
    background: #4CAF50;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
}

/* Demo Notice */
.demo-notice {
    background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    text-align: center;
    margin-top: 20px;
    font-size: 0.9rem;
}

.demo-notice i {
    margin-right: 8px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .users-grid {
        grid-template-columns: 1fr;
    }
    
    .spin-indicators {
        flex-direction: column;
        align-items: center;
    }
    
    .session-info {
        flex-direction: column;
        gap: 10px;
    }
}
</style>

<script>
// Global variables for multiplayer demo
let restaurantData = null;
let selectedRestaurant = null;
let isSpinning = false;
let currentRotation = 0;

// Mock restaurant data for demo
const demoRestaurants = [
    {
        id: 'demo_1',
        name: 'Jalapeno And Cilantro Grill',
        cuisine: 'Mexican',
        price_range: '$$',
        rating: 4.8,
        review_count: 44,
        address: '28 S Main St Milltown, NJ 08850',
        phone: '+1-732-555-0123',
        url: 'https://yelp.com/biz/jalapeno-cilantro-grill',
        image_url: 'https://via.placeholder.com/300x200?text=Mexican+Grill',
        coordinates: {'latitude': 40.4567, 'longitude': -74.4432},
        categories: ['Mexican', 'Latin American', 'Restaurants'],
        mood_match: 'Mexican cuisine is known for its spicy dishes, offering an exciting flavor profile.',
        reviews: []
    },
    {
        id: 'demo_2',
        name: 'Ara\'s Hot Chicken',
        cuisine: 'Halal',
        price_range: '$$',
        rating: 4.7,
        review_count: 31,
        address: '323 Raritan Ave Highland Park, NJ 08904',
        phone: '+1-732-555-0456',
        url: 'https://yelp.com/biz/aras-hot-chicken',
        image_url: 'https://via.placeholder.com/300x200?text=Hot+Chicken',
        coordinates: {'latitude': 40.4989, 'longitude': -74.4247},
        categories: ['Halal', 'Chicken', 'Restaurants'],
        mood_match: 'The name itself suggests spicy chicken, implying an exciting and flavorful experience.',
        reviews: []
    },
    {
        id: 'demo_3',
        name: '蜀世冒菜 S&Y Mini HotPot',
        cuisine: 'Hot Pot',
        price_range: '$$',
        rating: 4.7,
        review_count: 26,
        address: '1644 NJ-27 Edison, NJ 08817',
        phone: '+1-732-555-0789',
        url: 'https://yelp.com/biz/sy-mini-hotpot',
        image_url: 'https://via.placeholder.com/300x200?text=Szechuan+Hot+Pot',
        coordinates: {'latitude': 40.5187, 'longitude': -74.4121},
        categories: ['Hot Pot', 'Chinese', 'Restaurants'],
        mood_match: 'Szechuan hot pot is known for its intense spiciness and interactive dining experience, making it exciting.',
        reviews: []
    }
];

// Initialize the demo
document.addEventListener('DOMContentLoaded', function() {
    console.log('Multiplayer demo loaded');
    
    // Set up the roulette
    restaurantData = {
        success: true,
        location: 'Somerset, NJ',
        mood: 'spicy and exciting',
        total_restaurants: demoRestaurants.length,
        restaurants: demoRestaurants,
        timestamp: new Date().toISOString()
    };
    
    // Create roulette sections
    createRouletteSections(demoRestaurants);
    
    // Create restaurant options
    createRestaurantOptions(demoRestaurants);
    
    // Set up spin button
    document.getElementById('spinButton').addEventListener('click', function() {
        if (!isSpinning) {
            spinRoulette();
        }
    });
    
    // Set up lobby actions
    document.getElementById('copyLobbyBtn').addEventListener('click', copyLobbyId);
    document.getElementById('inviteBtn').addEventListener('click', inviteFriends);
    
    // Generate random lobby ID on page load
    document.getElementById('lobbyId').textContent = generateLobbyId();
});

function createRouletteSections(restaurants) {
    const sectionsContainer = document.getElementById('rouletteSections');
    sectionsContainer.innerHTML = '';
    
    restaurants.forEach((restaurant, index) => {
        const section = document.createElement('div');
        section.className = 'roulette-section';
        section.style.transform = `rotate(${index * (360 / restaurants.length)}deg)`;
        
        // Use casino-style red/black alternating colors
        const isRed = index % 2 === 0;
        section.style.background = isRed 
            ? 'linear-gradient(45deg, #FF0000, #CC0000)' 
            : 'linear-gradient(45deg, #000000, #333333)';
        
        // Apply inline styles for proper positioning
        section.style.position = 'absolute';
        section.style.width = '50%';
        section.style.height = '50%';
        section.style.top = '0';
        section.style.left = '50%';
        section.style.transformOrigin = '0 100%';
        section.style.display = 'flex';
        section.style.alignItems = 'center';
        section.style.justifyContent = 'center';
        section.style.color = 'white';
        section.style.fontWeight = 'bold';
        section.style.zIndex = '1';
        
        const sectionContent = document.createElement('div');
        sectionContent.className = 'section-content';
        sectionContent.innerHTML = `
            <div class="section-text">${restaurant.name}</div>
            <div class="section-rating">${restaurant.rating}★</div>
        `;
        
        section.appendChild(sectionContent);
        sectionsContainer.appendChild(section);
    });
}

function createRestaurantOptions(restaurants) {
    const optionsContainer = document.getElementById('restaurantOptions');
    optionsContainer.innerHTML = '';
    
    restaurants.forEach((restaurant, index) => {
        const option = document.createElement('div');
        option.className = 'restaurant-option';
        option.innerHTML = `
            <div class="option-number">${index + 1}</div>
            <div class="option-details">
                <div class="option-name">${restaurant.name}</div>
                <div class="option-cuisine">${restaurant.cuisine} • ${restaurant.price_range} • ${restaurant.rating}★ (${restaurant.review_count} reviews)</div>
                <div class="option-address">${restaurant.address}</div>
            </div>
        `;
        
        optionsContainer.appendChild(option);
    });
}

function spinRoulette() {
    if (isSpinning || !restaurantData) return;
    
    isSpinning = true;
    const spinButton = document.getElementById('spinButton');
    const wheel = document.getElementById('rouletteWheel');
    
    // Update button and add spinning effect
    spinButton.disabled = true;
    spinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Spinning Together...';
    wheel.classList.add('spinning');
    
    // Random rotation
    const fullRotations = 5 + Math.random() * 5;
    const randomAngle = Math.random() * 360;
    const totalRotation = currentRotation + (fullRotations * 360) + randomAngle;
    currentRotation = totalRotation;
    
    // Apply rotation
    wheel.style.transform = `rotate(${totalRotation}deg)`;
    wheel.style.transition = 'transform 4s cubic-bezier(0.23, 1, 0.32, 1)';
    
    // Calculate winner
    setTimeout(() => {
        const restaurants = restaurantData.restaurants;
        const anglePerRestaurant = 360 / restaurants.length;
        const finalAngle = totalRotation % 360;
        const selectedIndex = Math.floor((360 - finalAngle) / anglePerRestaurant) % restaurants.length;
        
        selectedRestaurant = restaurants[selectedIndex];
        
        // Remove spinning effect
        wheel.classList.remove('spinning');
        
        // Update button
        spinButton.disabled = false;
        spinButton.innerHTML = '<i class="fas fa-play"></i> Spin Again!';
        isSpinning = false;
        
        // Show winner
        showWinner(selectedRestaurant);
        
    }, 4000);
}

function showWinner(restaurant) {
    // Highlight the winning restaurant option
    const options = document.querySelectorAll('.restaurant-option');
    options.forEach((option, index) => {
        if (restaurantData.restaurants[index].id === restaurant.id) {
            option.classList.add('winner');
        } else {
            option.classList.remove('winner');
        }
    });
}

// Generate random lobby ID
function generateLobbyId() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let result = '#RRL-';
    for (let i = 0; i < 6; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}

// Copy lobby ID to clipboard
function copyLobbyId() {
    const lobbyId = document.getElementById('lobbyId').textContent;
    navigator.clipboard.writeText(lobbyId).then(() => {
        const button = document.getElementById('copyLobbyBtn');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i> Copied!';
        button.style.background = '#4CAF50';
        button.style.borderColor = '#4CAF50';
        button.style.color = 'white';
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = 'transparent';
            button.style.borderColor = '#4CAF50';
            button.style.color = '#4CAF50';
        }, 2000);
    });
}

// Simulate inviting friends
function inviteFriends() {
    const button = document.getElementById('inviteBtn');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i> Invite Sent!';
    button.style.background = '#4CAF50';
    button.style.borderColor = '#4CAF50';
    button.style.color = 'white';
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.style.background = 'transparent';
        button.style.borderColor = '#4CAF50';
        button.style.color = '#4CAF50';
    }, 2000);
}
</script>
{% endblock %}
